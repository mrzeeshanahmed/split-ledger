
[7m[1m[36m RUN [39m[22m[27m [36mv1.6.1[39m [90mD:/split_ledger/backend[39m

 [32mÎ“Â£Ã´[39m tests/integration/tenantContext.test.ts [2m ([22m[2m16 tests[22m[2m)[22m[90m 121[2mms[22m[39m
 [33mÎ“Â¥Â»[39m tests/integration/apiKeys.test.ts [2m ([22m[2m3 tests[22m [2m|[22m [31m3 failed[39m[2m)[22m[33m 1199[2mms[22m[39m
[31m   [33mÎ“Â¥Â»[31m tests/integration/apiKeys.test.ts[2m > [22mAPI Keys Integration Tests[2m > [22mCreate key Î“Ã¥Ã† use key in request Î“Ã¥Ã† verify auth succeeds[39m
[31m     Î“Ã¥Ã† expected 500 to be 200 // Object.is equality[39m
[31m   [33mÎ“Â¥Â»[31m tests/integration/apiKeys.test.ts[2m > [22mAPI Keys Integration Tests[2m > [22mRevoke key Î“Ã¥Ã† use key Î“Ã¥Ã† verify 401 returned[39m
[31m     Î“Ã¥Ã† Cannot read properties of undefined (reading 'id')[39m
[31m   [33mÎ“Â¥Â»[31m tests/integration/apiKeys.test.ts[2m > [22mAPI Keys Integration Tests[2m > [22mScope check: key with read scope returns correctly while denied actions will fail[39m
[31m     Î“Ã¥Ã† Cannot read properties of undefined (reading 'id')[39m
 [33mÎ“Â¥Â»[39m tests/integration/auth.test.ts [2m ([22m[2m4 tests[22m [2m|[22m [31m3 failed[39m[2m)[22m[33m 4104[2mms[22m[39m
[31m   [33mÎ“Â¥Â»[31m tests/integration/auth.test.ts[2m > [22mAuth Flow Integration Tests[2m > [22mRegister Î“Ã¥Ã† login Î“Ã¥Ã† get /auth/me Î“Ã¥Ã† logout Î“Ã¥Ã† verify token invalidated[39m
[31m     Î“Ã¥Ã† expected 500 to be 200 // Object.is equality[39m
[31m   [33mÎ“Â¥Â»[31m tests/integration/auth.test.ts[2m > [22mAuth Flow Integration Tests[2m > [22mPassword reset: forgot Î“Ã¥Ã† reset Î“Ã¥Ã† login with new password[39m
[31m     Î“Ã¥Ã† expected 500 to be 200 // Object.is equality[39m
[31m   [33mÎ“Â¥Â»[31m tests/integration/auth.test.ts[2m > [22mAuth Flow Integration Tests[2m > [22mRate limit: 11th login attempt within 15 min returns 429[39m
[31m     Î“Ã¥Ã† expected 500 to be 401 // Object.is equality[39m
 [33mÎ“Â¥Â»[39m tests/integration/tenantIsolation.test.ts [2m ([22m[2m9 tests[22m [2m|[22m [31m2 failed[39m[2m)[22m[33m 20181[2mms[22m[39m
[31m   [33mÎ“Â¥Â»[31m tests/integration/tenantIsolation.test.ts[2m > [22mTenant Isolation Integration Tests[2m > [22mSearch Path Isolation[2m > [22mshould isolate data between tenants using search_path[39m
[31m     Î“Ã¥Ã† relation "users" does not exist[39m
[31m   [33mÎ“Â¥Â»[31m tests/integration/tenantIsolation.test.ts[2m > [22mTenant Isolation Integration Tests[2m > [22mTenant Pool Management[2m > [22mshould create separate pools for different tenants[39m
[31m     Î“Ã¥Ã† expected 'public' to be 'tenant_0c3619943c7f4ae1b8e830404e2013Î“Ã‡Âª' // Object.is equality[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Suites 1 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/tenantIsolation.test.ts > Tenant Isolation Integration Tests
Error: Hook timed out in 10000ms.
If this is a long-running hook, pass a timeout value as the last argument or configure it globally with "hookTimeout".
Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/9]Î“Ã„Â»

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 8 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/apiKeys.test.ts > API Keys Integration Tests > Create key Î“Ã¥Ã† use key in request Î“Ã¥Ã† verify auth succeeds
AssertionError: expected 500 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 500

 Î“Â¥Â» tests/integration/apiKeys.test.ts:94:31
     92|             .set('Authorization', `Bearer ${rawKey}`);
     93| 
     94|         expect(resUse.status).toBe(200);
       |                               ^
     95|     });
     96| 

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[2/9]Î“Ã„Â»

 FAIL  tests/integration/apiKeys.test.ts > API Keys Integration Tests > Revoke key Î“Ã¥Ã† use key Î“Ã¥Ã† verify 401 returned
 FAIL  tests/integration/apiKeys.test.ts > API Keys Integration Tests > Scope check: key with read scope returns correctly while denied actions will fail
TypeError: Cannot read properties of undefined (reading 'id')
 Î“Â¥Â» tests/integration/apiKeys.test.ts:66:53
     64|         // Clean all api keys
     65|         const { rows: tenantRes } = await query('SELECT id FROM tenantÎ“Ã‡Âª
     66|         const schema = getTenantSchema(tenantRes[0].id);
       |                                                     ^
     67|         const client = await tenantDb.getClient(schema);
     68|         await client.query('DELETE FROM api_keys');

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[3/9]Î“Ã„Â»

 FAIL  tests/integration/auth.test.ts > Auth Flow Integration Tests > Register Î“Ã¥Ã† login Î“Ã¥Ã† get /auth/me Î“Ã¥Ã† logout Î“Ã¥Ã† verify token invalidated
AssertionError: expected 500 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 500

 Î“Â¥Â» tests/integration/auth.test.ts:93:33
     91|             });
     92| 
     93|         expect(resLogin.status).toBe(200);
       |                                 ^
     94|         expect(resLogin.headers['set-cookie']).toBeDefined();
     95|         cookies = (resLogin.headers['set-cookie'] as unknown as stringÎ“Ã‡Âª

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[4/9]Î“Ã„Â»

 FAIL  tests/integration/auth.test.ts > Auth Flow Integration Tests > Password reset: forgot Î“Ã¥Ã† reset Î“Ã¥Ã† login with new password
AssertionError: expected 500 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 500

 Î“Â¥Â» tests/integration/auth.test.ts:212:33
    210|             });
    211| 
    212|         expect(resReset.status).toBe(200);
       |                                 ^
    213| 
    214|         // Try loggin in with new password

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[5/9]Î“Ã„Â»

 FAIL  tests/integration/auth.test.ts > Auth Flow Integration Tests > Rate limit: 11th login attempt within 15 min returns 429
AssertionError: expected 500 to be 401 // Object.is equality

- Expected
+ Received

- 401
+ 500

 Î“Â¥Â» tests/integration/auth.test.ts:240:38
    238| 
    239|             // 401 means auth failed but request was processed
    240|             expect(resFailed.status).toBe(401);
       |                                      ^
    241|         }
    242| 

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[6/9]Î“Ã„Â»

 FAIL  tests/integration/tenantIsolation.test.ts > Tenant Isolation Integration Tests > Search Path Isolation > should isolate data between tenants using search_path
error: relation "users" does not exist
 Î“Â¥Â» ../node_modules/pg/lib/client.js:624:17
 Î“Â¥Â» tests/integration/tenantIsolation.test.ts:88:7
     86|       // Insert test data in tenant1
     87|       const client1 = await tenantDb.getClient(tenant1Schema);
     88|       await client1.query(
       |       ^
     89|         `INSERT INTO users (email, password_hash, first_name, last_namÎ“Ã‡Âª
     90|          VALUES ($1, $2, $3, $4, 'member', true)`,

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»
Serialized Error: { length: 104, severity: 'ERROR', code: '42P01', detail: undefined, hint: undefined, position: '13', internalPosition: undefined, internalQuery: undefined, where: undefined, schema: undefined, table: undefined, column: undefined, dataType: undefined, constraint: undefined, file: 'parse_relation.c', line: '1392', routine: 'parserOpenTable' }
Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[7/9]Î“Ã„Â»

 FAIL  tests/integration/tenantIsolation.test.ts > Tenant Isolation Integration Tests > Tenant Pool Management > should create separate pools for different tenants
AssertionError: expected 'public' to be 'tenant_0c3619943c7f4ae1b8e830404e2013Î“Ã‡Âª' // Object.is equality

- Expected
+ Received

- tenant_0c3619943c7f4ae1b8e830404e2013fd
+ public

 Î“Â¥Â» tests/integration/tenantIsolation.test.ts:161:33
    159|       const { rows: schema2 } = await client2.query('SELECT current_scÎ“Ã‡Âª
    160| 
    161|       expect(schema1[0].schema).toBe(tenant1Schema);
       |                                 ^
    162|       expect(schema2[0].schema).toBe(tenant2Schema);
    163| 

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[8/9]Î“Ã„Â»

[2m Test Files [22m [1m[31m3 failed[39m[22m[2m | [22m[1m[32m1 passed[39m[22m[90m (4)[39m
[2m      Tests [22m [1m[31m8 failed[39m[22m[2m | [22m[1m[32m24 passed[39m[22m[90m (32)[39m
[2m   Start at [22m 21:37:59
[2m   Duration [22m 21.07s[2m (transform 521ms, setup 553ms, collect 2.92s, tests 25.61s, environment 1ms, prepare 551ms)[22m

